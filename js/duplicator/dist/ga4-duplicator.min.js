"use strict";window.createGA4Duplicator=function(t){if(window.__ga4DuplicatorInitialized)return void(t.debug&&console.warn("GA4 Duplicator: already initialized."));const e=[];if(t.destinations&&Array.isArray(t.destinations))for(let r=0;r<t.destinations.length;r++)e.push(t.destinations[r]);if(t.server_container_url&&e.push({measurement_id:"*",server_container_url:t.server_container_url,server_container_path:t.server_container_path}),0===e.length)return void console.error("GA4 Duplicator: either server_container_url or destinations array is required");function r(t){return""===(t=(t=String(t||"")).replace(/\/+$/,""))?"/":t}function n(t,e){if(!t||"*"===t)return!0;try{const r=t.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*");return new RegExp("^"+r+"$","i").test(e)}catch(r){return t.toLowerCase()===e.toLowerCase()}}function i(t){const e=String(t.server_container_url||"").trim().replace(/\/+$/,""),n=t.server_container_path||"/g/collect",i=new URL(e,location.href);var o,c;return i.pathname&&"/"!==i.pathname||(i.pathname="/g/collect"),i.pathname=(o=r(i.pathname),c=n,o.replace(/\/+$/,"")+"/"+c.replace(/^\/+/,"")),i.search="",i.hash="",i}const o={debug:!!t.debug,isTargetUrl:function(t){if(!t||"string"!=typeof t)return!1;try{const n=new URL(t,location.href);for(let t=0;t<e.length;t++){const o=i(e[t]);if(n.origin===o.origin&&r(n.pathname)===r(o.pathname))return!1}const o=n.searchParams,c=o.has("gtm"),a=o.has("tag_exp"),s=o.get("tid")||o.get("id")||"",l=/^G-[A-Z0-9]+$/i.test(s);return c&&a&&l}catch(r){if("string"==typeof t){for(let r=0;r<e.length;r++)try{const n=i(e[r]),o=n.origin+n.pathname;if(-1!==t.indexOf(o))return!1}catch(t){}const r=-1!==t.indexOf("gtm="),n=-1!==t.indexOf("tag_exp="),o=t.match(/[?&](?:tid|id)=G-[A-Za-z0-9]+/);return!!(r&&n&&o)}return!1}},buildDuplicateUrl:function(t){const r=function(t){for(let r=0;r<e.length;r++)if(n(e[r].measurement_id,t))return e[r];return null}(function(t){try{const e=new URL(t,location.href);return e.searchParams.get("tid")||e.searchParams.get("id")||""}catch(e){const r=t.match(/[?&](?:tid|id)=([^&?#]+)/);return r?decodeURIComponent(r[1]):""}}(t));if(!r)return"";const o=i(r);try{const e=new URL(t,location.href);o.search=e.search}catch(t){}return o.toString()}},c=[new class{install(t){const e=window.fetch;window.fetch=function(r,n){const i="string"==typeof r?r:r instanceof URL?r.toString():r.url,o=n&&n.method||r.method||"GET";if(t.isTargetUrl(i)){const c=(o||"GET").toUpperCase();let a=Promise.resolve(void 0);if("POST"===c)if(n&&Object.prototype.hasOwnProperty.call(n,"body"))a=Promise.resolve(n.body);else if("undefined"!=typeof Request&&r instanceof Request)try{a=r.clone().blob().catch(()=>{})}catch(t){a=Promise.resolve(void 0)}const s=e.apply(this,arguments),l=t.buildDuplicateUrl(i);return"GET"===c?e(l,{method:"GET",keepalive:!0}).catch(e=>{t.debug&&console.error("gtm interceptor: error duplicating GET fetch:",e)}):"POST"===c&&a.then(r=>{e(l,{method:"POST",body:r,keepalive:!0}).catch(e=>{t.debug&&console.error("gtm interceptor: error duplicating POST fetch:",e)})}),s}return e.apply(this,arguments)}}},new class{install(t){const e=XMLHttpRequest.prototype.open,r=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(t,r){return this._requestMethod=t,this._requestUrl=r,e.apply(this,arguments)},XMLHttpRequest.prototype.send=function(e){if(this._requestUrl&&t.isTargetUrl(this._requestUrl)){const n=r.apply(this,arguments);try{const r=(this._requestMethod||"GET").toUpperCase(),n=t.buildDuplicateUrl(this._requestUrl);"GET"===r?fetch(n,{method:"GET",keepalive:!0}).catch(e=>{t.debug&&console.error("gtm interceptor: error duplicating GET xhr:",e)}):"POST"===r&&fetch(n,{method:"POST",body:e,keepalive:!0}).catch(e=>{t.debug&&console.error("gtm interceptor: error duplicating POST xhr:",e)})}catch(e){t.debug&&console.error("gtm interceptor: xhr duplication failed:",e)}return n}return r.apply(this,arguments)}}},new class{install(t){if(!navigator.sendBeacon)return;const e=navigator.sendBeacon;navigator.sendBeacon=function(r,n){if(t.isTargetUrl(r)){const i=e.apply(this,arguments);try{e.call(navigator,t.buildDuplicateUrl(r),n)}catch(e){t.debug&&console.error("gtm interceptor: error duplicating sendBeacon:",e)}return i}return e.apply(this,arguments)}}},new class{install(t){try{const e=Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"src"),r=e&&e.set,n=e&&e.get,i=HTMLScriptElement.prototype.setAttribute,o=e=>{try{if(!t.isTargetUrl(e))return;fetch(t.buildDuplicateUrl(e),{method:"GET",keepalive:!0}).catch(e=>{t.debug&&console.error("gtm interceptor: error duplicating script GET:",e)})}catch(t){}};if(r&&n){const t=r,e=n;Object.defineProperty(HTMLScriptElement.prototype,"src",{configurable:!0,enumerable:!0,get:function(){return e.call(this)},set:function(e){try{const t=this.__ga4LastSrcDuplicated;e&&e!==t&&(o(String(e)),this.__ga4LastSrcDuplicated=String(e));const r=this,n=function(){try{const t=r.src;t&&t!==r.__ga4LastSrcDuplicated&&(o(t),r.__ga4LastSrcDuplicated=t)}catch(t){}r.removeEventListener("load",n)};this.addEventListener("load",n)}catch(t){}return t.call(this,e)}})}HTMLScriptElement.prototype.setAttribute=function(t,e){try{if("src"===String(t).toLowerCase()){const t=String(e),r=this.__ga4LastSrcDuplicated;t&&t!==r&&(o(t),this.__ga4LastSrcDuplicated=t);const n=this,i=function(){try{const t=n.src;t&&t!==n.__ga4LastSrcDuplicated&&(o(t),n.__ga4LastSrcDuplicated=t)}catch(t){}n.removeEventListener("load",i)};this.addEventListener("load",i)}}catch(t){}return i.apply(this,arguments)}}catch(t){}}}];for(let e=0;e<c.length;e++)try{c[e].install(o)}catch(e){t.debug&&console.error("GA4 Duplicator: failed to install interceptor",e)}window.__ga4DuplicatorInitialized=!0};