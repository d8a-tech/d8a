/* ga4-duplicator - built 2026-01-09T20:55:48.792Z */
"use strict";(()=>{window.createGA4Duplicator=function(d){class b{install(e){let r=window.fetch;window.fetch=function(n,i){let c=typeof n=="string"?n:n instanceof URL?n.toString():n.url,a=i&&i.method||n.method||"GET";if(e.isTargetUrl(c)){let o=(a||"GET").toUpperCase(),s=Promise.resolve(void 0);if(o==="POST"){if(i&&Object.prototype.hasOwnProperty.call(i,"body"))s=Promise.resolve(i.body);else if(typeof Request!="undefined"&&n instanceof Request)try{s=n.clone().blob().catch(()=>{})}catch(l){s=Promise.resolve(void 0)}}let u=r.apply(this,arguments),h=e.buildDuplicateUrl(c);return o==="GET"?r(h,{method:"GET",keepalive:!0}).catch(l=>{e.debug&&console.error("gtm interceptor: error duplicating GET fetch:",l)}):o==="POST"&&s.then(l=>{r(h,{method:"POST",body:l,keepalive:!0}).catch(f=>{e.debug&&console.error("gtm interceptor: error duplicating POST fetch:",f)})}),u}return r.apply(this,arguments)}}}class S{install(e){let r=XMLHttpRequest.prototype.open,n=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(i,c){return this._requestMethod=i,this._requestUrl=c,r.apply(this,arguments)},XMLHttpRequest.prototype.send=function(i){if(this._requestUrl&&e.isTargetUrl(this._requestUrl)){let c=n.apply(this,arguments);try{let a=(this._requestMethod||"GET").toUpperCase(),o=e.buildDuplicateUrl(this._requestUrl);a==="GET"?fetch(o,{method:"GET",keepalive:!0}).catch(s=>{e.debug&&console.error("gtm interceptor: error duplicating GET xhr:",s)}):a==="POST"&&fetch(o,{method:"POST",body:i,keepalive:!0}).catch(s=>{e.debug&&console.error("gtm interceptor: error duplicating POST xhr:",s)})}catch(a){e.debug&&console.error("gtm interceptor: xhr duplication failed:",a)}return c}return n.apply(this,arguments)}}}class U{install(e){if(!navigator.sendBeacon)return;let r=navigator.sendBeacon;navigator.sendBeacon=function(n,i){if(e.isTargetUrl(n)){let c=r.apply(this,arguments);try{r.call(navigator,e.buildDuplicateUrl(n),i)}catch(a){e.debug&&console.error("gtm interceptor: error duplicating sendBeacon:",a)}return c}return r.apply(this,arguments)}}}class L{install(e){try{let r=Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"src"),n=r&&r.set,i=r&&r.get,c=HTMLScriptElement.prototype.setAttribute,a=o=>{try{if(!e.isTargetUrl(o))return;fetch(e.buildDuplicateUrl(o),{method:"GET",keepalive:!0}).catch(s=>{e.debug&&console.error("gtm interceptor: error duplicating script GET:",s)})}catch(s){}};if(n&&i){let o=n,s=i;Object.defineProperty(HTMLScriptElement.prototype,"src",{configurable:!0,enumerable:!0,get:function(){return s.call(this)},set:function(u){try{let h=this.__ga4LastSrcDuplicated;u&&u!==h&&(a(String(u)),this.__ga4LastSrcDuplicated=String(u));let l=this,f=function(){try{let p=l.src;p&&p!==l.__ga4LastSrcDuplicated&&(a(p),l.__ga4LastSrcDuplicated=p)}catch(p){}l.removeEventListener("load",f)};this.addEventListener("load",f)}catch(h){}o.call(this,u)}})}HTMLScriptElement.prototype.setAttribute=function(o,s){try{if(String(o).toLowerCase()==="src"){let u=String(s),h=this.__ga4LastSrcDuplicated;u&&u!==h&&(a(u),this.__ga4LastSrcDuplicated=u);let l=this,f=function(){try{let p=l.src;p&&p!==l.__ga4LastSrcDuplicated&&(a(p),l.__ga4LastSrcDuplicated=p)}catch(p){}l.removeEventListener("load",f)};this.addEventListener("load",f)}}catch(u){}return c.apply(this,arguments)}}catch(r){}}}if(window.__ga4DuplicatorInitialized){d.debug&&console.warn("GA4 Duplicator: already initialized.");return}let g=[];if(d.destinations&&Array.isArray(d.destinations))for(let t=0;t<d.destinations.length;t++)g.push(d.destinations[t]);if(d.server_container_url&&g.push({measurement_id:"*",server_container_url:d.server_container_url,server_container_path:d.server_container_path}),g.length===0){console.error("GA4 Duplicator: either server_container_url or destinations array is required");return}function m(t){return t=String(t||""),t=t.replace(/\/+$/,""),t===""?"/":t}function v(t,e){return t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,"")}function D(t,e){if(!t||t==="*")return!0;try{let r=t.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*");return new RegExp("^"+r+"$","i").test(e)}catch(r){return t.toLowerCase()===e.toLowerCase()}}function w(t){try{let e=new URL(t,location.href);return e.searchParams.get("tid")||e.searchParams.get("id")||""}catch(e){let r=t.match(/[?&](?:tid|id)=([^&?#]+)/);return r?decodeURIComponent(r[1]):""}}function T(t){for(let e=0;e<g.length;e++)if(D(g[e].measurement_id,t))return g[e];return null}function y(t){let e=String(t.server_container_url||"").trim().replace(/\/+$/,""),r=t.server_container_path||"/g/collect",n=new URL(e,location.href);return(!n.pathname||n.pathname==="/")&&(n.pathname="/g/collect"),n.pathname=v(m(n.pathname),r),n.search="",n.hash="",n}function I(t){if(!t||typeof t!="string")return!1;try{let e=new URL(t,location.href);for(let o=0;o<g.length;o++){let s=y(g[o]);if(e.origin===s.origin&&m(e.pathname)===m(s.pathname))return!1}let r=e.searchParams,n=r.has("gtm"),i=r.has("tag_exp"),c=r.get("tid")||r.get("id")||"",a=/^G-[A-Z0-9]+$/i.test(c);return n&&i&&a}catch(e){if(typeof t=="string"){for(let c=0;c<g.length;c++)try{let a=y(g[c]),o=a.origin+a.pathname;if(t.indexOf(o)!==-1)return!1}catch(a){}let r=t.indexOf("gtm=")!==-1,n=t.indexOf("tag_exp=")!==-1,i=t.match(/[?&](?:tid|id)=G-[A-Za-z0-9]+/);return!!(r&&n&&i)}return!1}}function G(t){let e=w(t),r=T(e);if(!r)return"";let n=y(r);try{let i=new URL(t,location.href);n.search=i.search}catch(i){}return n.toString()}let R={debug:!!d.debug,isTargetUrl:I,buildDuplicateUrl:G},_=[new b,new S,new U,new L];for(let t=0;t<_.length;t++)try{_[t].install(R)}catch(e){d.debug&&console.error("GA4 Duplicator: failed to install interceptor",e)}window.__ga4DuplicatorInitialized=!0};})();
//# sourceMappingURL=ga4-duplicator.min.js.map
