/* ga4-duplicator - built 2026-02-15T17:10:38.667Z */
"use strict";(()=>{var E="dev-26-02";window.createGA4Duplicator=function(h){class L{install(t){let r=window.fetch;window.fetch=function(o,n){let c=typeof o=="string"?o:o instanceof URL?o.toString():o.url,a=n&&n.method||o.method||"GET";if(t.isTargetUrl(c)){let l=(a||"GET").toUpperCase(),u=Promise.resolve(void 0);if(l==="POST"){if(n&&Object.prototype.hasOwnProperty.call(n,"body"))u=Promise.resolve(n.body);else if(typeof Request!="undefined"&&o instanceof Request)try{u=o.clone().blob().catch(()=>{})}catch(s){u=Promise.resolve(void 0)}}let i=r.apply(this,arguments),p=t.buildDuplicateUrl(c),g=t.getConvertToGet(c);return l==="GET"?r(p,{method:"GET",keepalive:!0}).catch(s=>{t.debug&&console.error("gtm interceptor: error duplicating GET fetch:",s)}):l==="POST"&&u.then(s=>{if(g){let d="";if(typeof s=="string")d=s;else if(s instanceof Blob){r(p,{method:"POST",body:s,keepalive:!0}).catch(m=>{t.debug&&console.error("gtm interceptor: error duplicating POST fetch (convert_to_get with Blob):",m)});return}let _=d.split(`
`),y=!1;for(let m=0;m<_.length;m++){let D=_[m].trim();if(D){let C=t.buildDuplicateUrl(c),M=v(C,D);r(M,{method:"GET",keepalive:!0}).catch(H=>{t.debug&&console.error("gtm interceptor: error duplicating GET fetch (from convert_to_get):",H)}),y=!0}}y||r(p,{method:"GET",keepalive:!0}).catch(m=>{t.debug&&console.error("gtm interceptor: error duplicating GET fetch (empty body convert_to_get):",m)})}else r(p,{method:"POST",body:s,keepalive:!0}).catch(d=>{t.debug&&console.error("gtm interceptor: error duplicating POST fetch:",d)})}),i}return r.apply(this,arguments)}}}class w{install(t){let r=XMLHttpRequest.prototype.open,o=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(n,c){return this._requestMethod=n,this._requestUrl=c,r.apply(this,arguments)},XMLHttpRequest.prototype.send=function(n){if(this._requestUrl&&t.isTargetUrl(this._requestUrl)){let c=o.apply(this,arguments);try{let a=(this._requestMethod||"GET").toUpperCase(),l=t.buildDuplicateUrl(this._requestUrl),u=t.getConvertToGet(this._requestUrl);if(a==="GET")fetch(l,{method:"GET",keepalive:!0}).catch(i=>{t.debug&&console.error("gtm interceptor: error duplicating GET xhr:",i)});else if(a==="POST")if(u){let i="";if(typeof n=="string")i=n;else if(n&&typeof n=="object")try{i=String(n)}catch(s){i=""}let p=i.split(`
`),g=!1;for(let s=0;s<p.length;s++){let d=p[s].trim();if(d){let _=t.buildDuplicateUrl(this._requestUrl),y=v(_,d);fetch(y,{method:"GET",keepalive:!0}).catch(m=>{t.debug&&console.error("gtm interceptor: error duplicating GET xhr (from convert_to_get):",m)}),g=!0}}g||fetch(l,{method:"GET",keepalive:!0}).catch(s=>{t.debug&&console.error("gtm interceptor: error duplicating GET xhr (empty body convert_to_get):",s)})}else fetch(l,{method:"POST",body:n,keepalive:!0}).catch(i=>{t.debug&&console.error("gtm interceptor: error duplicating POST xhr:",i)})}catch(a){t.debug&&console.error("gtm interceptor: xhr duplication failed:",a)}return c}return o.apply(this,arguments)}}}class I{install(t){if(!navigator.sendBeacon)return;let r=navigator.sendBeacon;navigator.sendBeacon=function(o,n){if(t.isTargetUrl(o)){let c=r.apply(this,arguments);try{let a=t.buildDuplicateUrl(o);if(t.getConvertToGet(o)){let u="";if(typeof n=="string")u=n;else if(n&&typeof n=="object")try{u=String(n)}catch(g){u=""}let i=u.split(`
`),p=!1;for(let g=0;g<i.length;g++){let s=i[g].trim();if(s){let d=t.buildDuplicateUrl(o),_=v(d,s);fetch(_,{method:"GET",keepalive:!0}).catch(y=>{t.debug&&console.error("gtm interceptor: error duplicating GET beacon (from convert_to_get):",y)}),p=!0}}p||fetch(a,{method:"GET",keepalive:!0}).catch(g=>{t.debug&&console.error("gtm interceptor: error duplicating GET beacon (empty body convert_to_get):",g)})}else r.call(navigator,a,n)}catch(a){t.debug&&console.error("gtm interceptor: error duplicating sendBeacon:",a)}return c}return r.apply(this,arguments)}}}class R{install(t){try{let r=Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"src"),o=r&&r.set,n=r&&r.get,c=HTMLScriptElement.prototype.setAttribute,a=l=>{try{if(!t.isTargetUrl(l))return;fetch(t.buildDuplicateUrl(l),{method:"GET",keepalive:!0}).catch(u=>{t.debug&&console.error("gtm interceptor: error duplicating script GET:",u)})}catch(u){}};if(o&&n){let l=o,u=n;Object.defineProperty(HTMLScriptElement.prototype,"src",{configurable:!0,enumerable:!0,get:function(){return u.call(this)},set:function(i){try{let p=this.__ga4LastSrcDuplicated;i&&i!==p&&(a(String(i)),this.__ga4LastSrcDuplicated=String(i));let g=this,s=function(){try{let d=g.src;d&&d!==g.__ga4LastSrcDuplicated&&(a(d),g.__ga4LastSrcDuplicated=d)}catch(d){}g.removeEventListener("load",s)};this.addEventListener("load",s)}catch(p){}l.call(this,i)}})}HTMLScriptElement.prototype.setAttribute=function(l,u){try{if(String(l).toLowerCase()==="src"){let i=String(u),p=this.__ga4LastSrcDuplicated;i&&i!==p&&(a(i),this.__ga4LastSrcDuplicated=i);let g=this,s=function(){try{let d=g.src;d&&d!==g.__ga4LastSrcDuplicated&&(a(d),g.__ga4LastSrcDuplicated=d)}catch(d){}g.removeEventListener("load",s)};this.addEventListener("load",s)}}catch(i){}return c.apply(this,arguments)}}catch(r){}}}if(window.__ga4DuplicatorInitialized){h.debug&&console.warn("GA4 Duplicator: already initialized.");return}let f=[];if(h.destinations&&Array.isArray(h.destinations))for(let e=0;e<h.destinations.length;e++){let t=h.destinations[e];f.push({measurement_id:t.measurement_id,server_container_url:t.server_container_url,convert_to_get:t.convert_to_get!==void 0?t.convert_to_get:h.convert_to_get})}if(h.server_container_url&&f.push({measurement_id:"*",server_container_url:h.server_container_url,convert_to_get:h.convert_to_get}),f.length===0){console.error("GA4 Duplicator: either server_container_url or destinations array is required");return}function T(e){return e=String(e||""),e=e.replace(/\/+$/,""),e===""?"/":e}function A(e,t){if(!e||e==="*")return!0;try{let r=e.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*");return new RegExp("^"+r+"$","i").test(t)}catch(r){return e.toLowerCase()===t.toLowerCase()}}function S(e){try{let t=new URL(e,location.href);return t.searchParams.get("tid")||t.searchParams.get("id")||""}catch(t){let r=e.match(/[?&](?:tid|id)=([^&?#]+)/);return r?decodeURIComponent(r[1]):""}}function G(e){for(let t=0;t<f.length;t++)if(A(f[t].measurement_id,e))return f[t];return null}function v(e,t){try{let r=new URL(e,location.href),o=new URLSearchParams(t);for(let[n]of o.entries())r.searchParams.delete(n);for(let[n,c]of o.entries())r.searchParams.append(n,c);return r.toString()}catch(r){let o=e.split("?")[0],n=e.match(/\?(.*)/)?e.match(/\?(.*)/)[1]:"",c=n+(n&&t?"&":"")+t;return o+(c?"?"+c:"")}}function b(e){let t=String(e.server_container_url||"").trim(),r=new URL(t,location.href);return r.search="",r.hash="",r}function P(e){if(!e||typeof e!="string")return!1;try{let t=new URL(e,location.href);for(let l=0;l<f.length;l++){let u=b(f[l]);if(t.origin===u.origin&&T(t.pathname)===T(u.pathname))return!1}let r=t.searchParams,o=r.has("gtm"),n=r.has("tag_exp"),c=r.get("tid")||r.get("id")||"",a=/^G-[A-Z0-9]+$/i.test(c);return o&&n&&a}catch(t){if(typeof e=="string"){for(let c=0;c<f.length;c++)try{let a=b(f[c]),l=a.origin+a.pathname;if(e.indexOf(l)!==-1)return!1}catch(a){}let r=e.indexOf("gtm=")!==-1,o=e.indexOf("tag_exp=")!==-1,n=e.match(/[?&](?:tid|id)=G-[A-Za-z0-9]+/);return!!(r&&o&&n)}return!1}}function O(e){let t=S(e),r=G(t);if(!r)return"";let o=b(r);try{let n=new URL(e,location.href);o.search=n.search,o.searchParams.set("_dtv",E),o.searchParams.set("_dtn","gd")}catch(n){}return o.toString()}function k(e){let t=S(e),r=G(t);return r?!!r.convert_to_get:!1}let q={debug:!!h.debug,isTargetUrl:P,buildDuplicateUrl:O,getConvertToGet:k},U=[new L,new w,new I,new R];for(let e=0;e<U.length;e++)try{U[e].install(q)}catch(t){h.debug&&console.error("GA4 Duplicator: failed to install interceptor",t)}window.__ga4DuplicatorInitialized=!0};})();
//# sourceMappingURL=gd.min.js.map
