/* ga4-duplicator - built 2026-01-26T22:28:30.628Z */
"use strict";(()=>{var S="v0.1.0";window.createGA4Duplicator=function(g){class b{install(e){let r=window.fetch;window.fetch=function(n,i){let c=typeof n=="string"?n:n instanceof URL?n.toString():n.url,s=i&&i.method||n.method||"GET";if(e.isTargetUrl(c)){let o=(s||"GET").toUpperCase(),a=Promise.resolve(void 0);if(o==="POST"){if(i&&Object.prototype.hasOwnProperty.call(i,"body"))a=Promise.resolve(i.body);else if(typeof Request!="undefined"&&n instanceof Request)try{a=n.clone().blob().catch(()=>{})}catch(l){a=Promise.resolve(void 0)}}let u=r.apply(this,arguments),h=e.buildDuplicateUrl(c);return o==="GET"?r(h,{method:"GET",keepalive:!0}).catch(l=>{e.debug&&console.error("gtm interceptor: error duplicating GET fetch:",l)}):o==="POST"&&a.then(l=>{r(h,{method:"POST",body:l,keepalive:!0}).catch(f=>{e.debug&&console.error("gtm interceptor: error duplicating POST fetch:",f)})}),u}return r.apply(this,arguments)}}}class U{install(e){let r=XMLHttpRequest.prototype.open,n=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(i,c){return this._requestMethod=i,this._requestUrl=c,r.apply(this,arguments)},XMLHttpRequest.prototype.send=function(i){if(this._requestUrl&&e.isTargetUrl(this._requestUrl)){let c=n.apply(this,arguments);try{let s=(this._requestMethod||"GET").toUpperCase(),o=e.buildDuplicateUrl(this._requestUrl);s==="GET"?fetch(o,{method:"GET",keepalive:!0}).catch(a=>{e.debug&&console.error("gtm interceptor: error duplicating GET xhr:",a)}):s==="POST"&&fetch(o,{method:"POST",body:i,keepalive:!0}).catch(a=>{e.debug&&console.error("gtm interceptor: error duplicating POST xhr:",a)})}catch(s){e.debug&&console.error("gtm interceptor: xhr duplication failed:",s)}return c}return n.apply(this,arguments)}}}class D{install(e){if(!navigator.sendBeacon)return;let r=navigator.sendBeacon;navigator.sendBeacon=function(n,i){if(e.isTargetUrl(n)){let c=r.apply(this,arguments);try{r.call(navigator,e.buildDuplicateUrl(n),i)}catch(s){e.debug&&console.error("gtm interceptor: error duplicating sendBeacon:",s)}return c}return r.apply(this,arguments)}}}class I{install(e){try{let r=Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"src"),n=r&&r.set,i=r&&r.get,c=HTMLScriptElement.prototype.setAttribute,s=o=>{try{if(!e.isTargetUrl(o))return;fetch(e.buildDuplicateUrl(o),{method:"GET",keepalive:!0}).catch(a=>{e.debug&&console.error("gtm interceptor: error duplicating script GET:",a)})}catch(a){}};if(n&&i){let o=n,a=i;Object.defineProperty(HTMLScriptElement.prototype,"src",{configurable:!0,enumerable:!0,get:function(){return a.call(this)},set:function(u){try{let h=this.__ga4LastSrcDuplicated;u&&u!==h&&(s(String(u)),this.__ga4LastSrcDuplicated=String(u));let l=this,f=function(){try{let d=l.src;d&&d!==l.__ga4LastSrcDuplicated&&(s(d),l.__ga4LastSrcDuplicated=d)}catch(d){}l.removeEventListener("load",f)};this.addEventListener("load",f)}catch(h){}o.call(this,u)}})}HTMLScriptElement.prototype.setAttribute=function(o,a){try{if(String(o).toLowerCase()==="src"){let u=String(a),h=this.__ga4LastSrcDuplicated;u&&u!==h&&(s(u),this.__ga4LastSrcDuplicated=u);let l=this,f=function(){try{let d=l.src;d&&d!==l.__ga4LastSrcDuplicated&&(s(d),l.__ga4LastSrcDuplicated=d)}catch(d){}l.removeEventListener("load",f)};this.addEventListener("load",f)}}catch(u){}return c.apply(this,arguments)}}catch(r){}}}if(window.__ga4DuplicatorInitialized){g.debug&&console.warn("GA4 Duplicator: already initialized.");return}let p=[];if(g.destinations&&Array.isArray(g.destinations))for(let t=0;t<g.destinations.length;t++)p.push(g.destinations[t]);if(g.server_container_url&&p.push({measurement_id:"*",server_container_url:g.server_container_url}),p.length===0){console.error("GA4 Duplicator: either server_container_url or destinations array is required");return}function y(t){return t=String(t||""),t=t.replace(/\/+$/,""),t===""?"/":t}function L(t,e){if(!t||t==="*")return!0;try{let r=t.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*");return new RegExp("^"+r+"$","i").test(e)}catch(r){return t.toLowerCase()===e.toLowerCase()}}function v(t){try{let e=new URL(t,location.href);return e.searchParams.get("tid")||e.searchParams.get("id")||""}catch(e){let r=t.match(/[?&](?:tid|id)=([^&?#]+)/);return r?decodeURIComponent(r[1]):""}}function w(t){for(let e=0;e<p.length;e++)if(L(p[e].measurement_id,t))return p[e];return null}function m(t){let e=String(t.server_container_url||"").trim(),r=new URL(e,location.href);return r.search="",r.hash="",r}function T(t){if(!t||typeof t!="string")return!1;try{let e=new URL(t,location.href);for(let o=0;o<p.length;o++){let a=m(p[o]);if(e.origin===a.origin&&y(e.pathname)===y(a.pathname))return!1}let r=e.searchParams,n=r.has("gtm"),i=r.has("tag_exp"),c=r.get("tid")||r.get("id")||"",s=/^G-[A-Z0-9]+$/i.test(c);return n&&i&&s}catch(e){if(typeof t=="string"){for(let c=0;c<p.length;c++)try{let s=m(p[c]),o=s.origin+s.pathname;if(t.indexOf(o)!==-1)return!1}catch(s){}let r=t.indexOf("gtm=")!==-1,n=t.indexOf("tag_exp=")!==-1,i=t.match(/[?&](?:tid|id)=G-[A-Za-z0-9]+/);return!!(r&&n&&i)}return!1}}function R(t){let e=v(t),r=w(e);if(!r)return"";let n=m(r);try{let i=new URL(t,location.href);n.search=i.search,n.searchParams.set("_dtv",S),n.searchParams.set("_dtn","gd")}catch(i){}return n.toString()}let G={debug:!!g.debug,isTargetUrl:T,buildDuplicateUrl:R},_=[new b,new U,new D,new I];for(let t=0;t<_.length;t++)try{_[t].install(G)}catch(e){g.debug&&console.error("GA4 Duplicator: failed to install interceptor",e)}window.__ga4DuplicatorInitialized=!0};})();
//# sourceMappingURL=gd.min.js.map
